<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESG Risk Decision Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

  <h1>ESG Risk Decision Dashboard <span class="sector-badge" id="sectorBadge">Custom Portfolio</span></h1>
  <p class="subtitle">
    A browser-only framework that translates ESG risk into capital allocation signals.
    <br><strong>All data stays on your machine.</strong>
  </p>

  <!-- Step 1: Choose Input Method -->
  <div class="section">
    <h2>ğŸ“¥ Choose Your Data Input Method</h2>
    <div class="input-methods">
      <div class="method-card" id="methodInline">
        <div class="method-icon">âœï¸</div>
        <h3>1. Manual Entry (Recommended)</h3>
        <p>Type risks directly. No files needed. Start here.</p>
        <button class="method-btn" onclick="showMethod('inline')">Start Typing â†’</button>
      </div>
      
      <div class="method-card" id="methodCSV">
        <div class="method-icon">ğŸ“</div>
        <h3>2. CSV Upload</h3>
        <p>Upload your existing ESG data. Use for bulk analysis.</p>
        <button class="method-btn" onclick="showMethod('csv')">Upload CSV â†’</button>
      </div>
      
      <div class="method-card" id="methodSample">
        <div class="method-icon">ğŸ¯</div>
        <h3>3. Sector Templates</h3>
        <p>Pre-configured risks for your industry. Great for demos.</p>
        <button class="method-btn" onclick="showMethod('sample')">Use Template â†’</button>
      </div>
    </div>
  </div>

  <!-- Inline Data Entry (Initially Hidden) -->
  <div id="inlineEntry" class="section hidden">
    <div class="section-header">
      <h2>âœï¸ Manual Risk Entry</h2>
      <p class="helper-text">Type risks below â€” no file needed. CSV export available after entry.</p>
    </div>
    
    <table id="inputTable" class="input-table">
      <thead>
        <tr>
          <th>Risk Factor</th>
          <th>
            Probability
            <div class="help-text">1â€“5 scale<br>(5 = High)</div>
          </th>
          <th>
            Financial Impact
            <div class="help-text">1â€“5 scale<br>(5 = High)</div>
          </th>
          <th>
            12â€“24 Months
            <div class="help-text">Momentum</div>
          </th>
          <th>
            3â€“5 Years
            <div class="help-text">Momentum</div>
          </th>
          <th style="width: 60px;"></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Rows will be added here -->
      </tbody>
    </table>
    
    <div class="table-controls">
      <button class="btn-secondary" onclick="addRow()">ï¼‹ Add Risk Factor</button>
      <button class="btn-primary" onclick="useTableData()">â–¶ Analyze Entered Data</button>
      <button class="btn-secondary" onclick="clearTable()">ğŸ—‘ï¸ Clear All</button>
    </div>
    
    <div class="tip-box">
      <strong>Tip:</strong> Start with 2â€“3 risks to see how the tool works. Add more later.
    </div>
  </div>

  <!-- CSV Upload (Initially Hidden) -->
  <div id="csvUpload" class="section hidden">
    <div class="section-header">
      <h2>ğŸ“ CSV Upload</h2>
      <p class="helper-text">Upload your ESG risk data in CSV format.</p>
    </div>
    
    <div class="upload-box">
      <label for="fileInput">Select CSV File</label>
      <input type="file" id="fileInput" accept=".csv">
      <div class="upload-note">
        Required columns: <code>Risk_Name,Probability_Score,Financial_Impact,Momentum_12_24M,Momentum_3_5Y</code>
      </div>
      <div class="tip-box">
        <strong>Need a template?</strong> 
        <a href="javascript:void(0)" onclick="downloadTemplate()">Download CSV template</a>
      </div>
    </div>
  </div>

  <!-- Sector Configuration -->
  <div id="sectorConfig" class="section hidden">
    <div class="section-header">
      <h2>ğŸ­ Sector Configuration</h2>
      <p class="helper-text">Select your industry to load relevant risk templates.</p>
    </div>
    
    <div class="sector-selector">
      <select id="sectorSelect">
        <option value="custom">Custom / All Sectors</option>
        <option value="energy">Energy & Utilities</option>
        <option value="tech">Technology</option>
        <option value="manufacturing">Manufacturing</option>
        <option value="finance">Financial Services</option>
        <option value="healthcare">Healthcare</option>
      </select>
      <button class="btn-primary" onclick="loadSectorPreset()">Load Sector Template</button>
    </div>
    
    <div id="sectorDescription" class="sector-description">
      Select an industry to see specific risk categories and default weights.
    </div>
  </div>

  <!-- Controls Section (Shown after data entry) -->
  <div id="controlsSection" class="section hidden">
    <h2>âš–ï¸ Risk Scoring Controls</h2>
    <div class="controls">
      <div class="control-group">
        <label for="probWeight">
          <div class="control-label">Probability Weight</div>
          <div class="control-value" id="probValue">3</div>
        </label>
        <input type="range" id="probWeight" min="1" max="5" value="3" step="0.5">
        <div class="control-range">
          <span>Conservative</span>
          <span>Aggressive</span>
        </div>
      </div>
      
      <div class="control-group">
        <label for="impactWeight">
          <div class="control-label">Financial Impact Weight</div>
          <div class="control-value" id="impactValue">3</div>
        </label>
        <input type="range" id="impactWeight" min="1" max="5" value="3" step="0.5">
        <div class="control-range">
          <span>Low Impact</span>
          <span>High Impact</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard Content (Initially Hidden) -->
  <div id="dashboard" class="hidden">
    <!-- All existing dashboard sections remain exactly as before -->
    <!-- Heatmap, Momentum Tracker, Capital Allocation, Export, etc. -->
    <!-- (Content from previous version - not repeating for brevity) -->
    
    <!-- Heatmap Section -->
    <div class="section">
      <h2>ğŸ“Š Portfolio ESG Risk Heatmap</h2>
      <p class="heatmap-subtitle">Probability Ã— Financial Impact = Risk Score</p>
      <div id="heatmap" class="heatmap"></div>
      <div class="heatmap-legend">
        <div class="legend-item"><span class="legend-color low"></span> Low Risk</div>
        <div class="legend-item"><span class="legend-color medium"></span> Medium Risk</div>
        <div class="legend-item"><span class="legend-color high"></span> High Risk</div>
      </div>
    </div>

    <!-- Risk Momentum Tracker -->
    <div class="section">
      <h2>ğŸ“ˆ Risk Momentum Tracker</h2>
      <div class="table-container">
        <table id="momentumTable">
          <thead>
            <tr>
              <th>Risk Factor</th>
              <th>12â€“24 Months</th>
              <th>3â€“5 Years</th>
              <th>Trend</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Capital Allocation Signals -->
    <div class="section">
      <h2>ğŸ¯ Capital Allocation Signals</h2>
      <div class="logic-summary">
        <div class="logic-card invest">
          <h3>INVEST / SCALE</h3>
          <p>Low or improving risk profile<br>Clear operational controls</p>
        </div>
        <div class="logic-card engage">
          <h3>ENGAGE / CONDITIONAL</h3>
          <p>Material risk exists<br>Mitigation levers available</p>
        </div>
        <div class="logic-card exit">
          <h3>AVOID / EXIT</h3>
          <p>High & accelerating risk<br>Weak incentives for change</p>
        </div>
      </div>
      
      <div class="table-container">
        <table id="decisionTable">
          <thead>
            <tr>
              <th>Risk Factor</th>
              <th>Risk Score</th>
              <th>Allocation Signal</th>
              <th>Rationale</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Export Section -->
    <div class="section">
      <h2>ğŸ“„ Export & Share</h2>
      <div class="export-actions">
        <button class="export-btn" onclick="exportPDF()">
          ğŸ“¥ Download Decision Snapshot (PDF)
        </button>
        <button class="export-btn secondary" onclick="exportCSV()">
          ğŸ“Š Export Risk Data (CSV)
        </button>
        <button class="export-btn secondary" onclick="copyToClipboard()">
          ğŸ“‹ Copy Summary to Clipboard
        </button>
      </div>
      <p class="export-note">
        All exports are generated locally. No data leaves your browser.
      </p>
    </div>

    <!-- Decision Logic Explanation -->
    <div class="section logic-section">
      <h2>ğŸ§® Decision Logic (Transparent & Editable)</h2>
      <div class="logic-rules">
        <div class="rule">
          <h3>AVOID / EXIT Signal</h3>
          <p>Triggers when: <code>Probability â‰¥ 4 AND Impact â‰¥ 4 AND (Momentum = "Up" OR "Critical")</code></p>
          <p>Financial translation: Likely capital impairment, EBITDA volatility >15%</p>
        </div>
        <div class="rule">
          <h3>ENGAGE / CONDITIONAL Signal</h3>
          <p>Triggers when: <code>Probability â‰¥ 3 OR Impact â‰¥ 4</code></p>
          <p>Financial translation: Manageable risk with mitigation ROI > 1.5x</p>
        </div>
        <div class="rule">
          <h3>INVEST / SCALE Signal</h3>
          <p>Triggers when: <code>Risk Score < 12 AND Momentum stable/improving</code></p>
          <p>Financial translation: Clean capital deployment, margin stability</p>
        </div>
      </div>
      <p class="logic-note">
        <strong>Note:</strong> Edit these rules directly in <code>script.js</code> to match your organization's risk appetite.
      </p>
    </div>
  </div>

  <!-- Navigation Bar -->
  <div class="nav-bar">
    <button class="nav-btn" onclick="goBackToInput()">â† Back to Data Entry</button>
    <span class="nav-status" id="navStatus">No data entered yet</span>
  </div>

  <!-- Footer -->
  <footer>
    <p>ESG Risk Decision Dashboard v1.2 â€¢ Client-Side Edition</p>
    <p class="footer-note">
      All calculations run locally in your browser. No data is stored or transmitted.
      <br>Built for finance, risk, and sustainability teams.
    </p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
